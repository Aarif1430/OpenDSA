<!DOCTYPE html>

<!--

    Samuel A. Micka

-->
<html>
  <head>
    <meta charset="UTF-8">
    <title>KMP Slideshow</title>
    <link rel="stylesheet" href="../../JSAV/css/JSAV.css" type="text/css" media="screen" title="no title" charset="utf-8" />
    <style>
    #container {
      width: 98%;
      position: relative;
    }
    .jsavcounter {
      position: absolute;
      top: 15px;
    }
    .jsavcanvas { height: 400px; }

    .jsavarray .jsavindex {
      min-width: 25px;
      width: 25px;
      font-size: 12px;
    }
    .jsavoutput {
      height: 75px;
    }
    </style>
  </head>
  <body>
    <h1>KMP Slideshow</h1>
  <div id="container">
    <div class="jsavcontrols"></div><span class="jsavcounter"></span>
    <p class="jsavoutput jsavline"></p>
    <div class="jsavcanvas"></div>
  </div>
  <style>
  </style>
    <script
       src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js">
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
<script src="../../JSAV/lib/jquery.transform.light.js"></script>
<script src="../../JSAV/lib/raphael.js"></script>
<script src="../../JSAV/build/JSAV-min.js"></script>
    <script>

    var av = new JSAV("container");


    var master = av.ds.array(['x','y','a','b','a','b','c','a','b','a','b','a','t','c','a','h','a','b','a','b','a','t','c','a','b'], {center: false, indexed: true});
    var sub = av.ds.array(['a','b','a','b','a','t','c','a','b',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '], {center: false});
    var align = av.ds.array(['-1','0','0','1','2','3','0','0','1',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '], {center: false});
    var master_label = av.label("Master String", {before: master});
    var sub_label = av.label("Sub String", {before: sub});
    var align_label = av.label("Alignment Array for Sub String", {before: align});


    av.umsg("First we have the Master string (indexed [0-n]), the Sub string (indexed [0-m]) and the alignment array for the Sub string.");

    av.step();
    av.umsg("We can now take a look at the pseudo-code and notice a few key variables... m, which will default to 0, s, which will default to 0, and also note that our strings are called master and sub, and the alignment array is calle align.");
    var kmp_pseudo = av.code("input: master string, sub string, align array\nm = 0\ns = 0\nwhile((s < sub.length) and (sub.length - s <= master.length - m)):\n\tif(master[m] == sub[s]):\n\t\tm++\n\t\ts++\n\telse if(s == 0):\n\t\tm++\n\telse:\n\t\ts = align[s]\nif(s == sub.length):\n\treturn m - sub.length\nelse \n\treturn -1", {before: master_label});


    var m = av.variable(["0"],{visible: true, label: "m = ", left: "150px", bottom: "460px"});
    var s = av.variable(["0"], {visible: true, label: "s = ", left: "150px", bottom: "430px"});

    //step
    av.step();
    av.umsg("We will also notice the termination condition of our loop, that s is less than the length of our sub string and that the length of the substring - s is <= length of the master - m.");


    av.step();
    sub.css(0, {"background-color": "red"});
    master.css(0, {"background-color": "red"});
    av.umsg("We notice that the first characters of each string (x and a) do not match...");

    //step
    av.step();
    sub.css(0, {"background-color": "white"});
    master.css(0, {"background-color": "white"});


    for(var i=sub.size()-1;i>0;i--){
      sub.value(i, sub.value(i-1));
    }
    sub.value(0, ' ');

    for(var x = align.size()-1; x > 0; x--){
      align.value(x, align.value(x-1));
    }
    align.value(0, ' ');
    av.umsg("Because there is a mismatch immediately we increment the pointer to the current location in the master string to one spot ahead so that we are comparing substring[0] to master[1], in other words we enter the second if statement (since s == 0) and increment m by 1.");
    kmp_pseudo.setCurrentLine(8);
    m.value("1");


    //step
    av.step();
    sub.css(1, {"background-color": "red"});
    master.css(1, {"background-color": "red"});
    av.umsg("We jump back to the beginning of the loop and notice that, once again, the first characters of each string (y and a) do not match...");
    kmp_pseudo.setCurrentLine(4);

    //step
    av.step();

    sub.css(1, {"background-color": "white"});
    master.css(1, {"background-color": "white"});

    for(i=sub.size()-1;i>0;i--){
      sub.value(i, sub.value(i-1));
    }


    for(x = align.size()-1; x > 0; x--){
      align.value(x, align.value(x-1));
    }


    av.umsg("Because there is a mismatch immediately we increment the pointer to the current location in the master string to one spot ahead so that we are comparing the substring[0] to master[2], this done by again entering the if statement on line 8 and setting m to m+1.");
    kmp_pseudo.setCurrentLine(8);
    m.value("2");  

    av.step();
    av.umsg("We can now observe that the next 4 characters match, meaning our loop ran smoothly 4 times, entering the first if statement and incrementing m and s ahead by 4 each.");
    kmp_pseudo.setCurrentLine(4);
    m.value("6");
    s.value("4");
    master.highlight([2,3,4,5]);
    sub.highlight([2,3,4,5]);


    //step
    av.step();
    sub.css(6, {"background-color": "red"});
    master.css(6, {"background-color": "red"});
    av.umsg("Now we can have some fun. We can now observe here that sub[0-3] match up with master [2-5]. Then everything is ruined when we realize that sub[4] (a) doesn't match up with master[6] (c)...");

    av.step();
    av.umsg("We can't enter the second if statement because s != 0, so we have to enter the else.");
    kmp_pseudo.setCurrentLine(7);



    //step
    av.step();
    align.highlight(6);
    kmp_pseudo.setCurrentLine(10);
    av.umsg("We now utilize the alignment array to figure out what index in the our substring we can jump to. We note that align[s] (align[4]) is 2, that means we shift our substring over so that the current index in the master string is aligned with sub[2]. Then this also resets our s value to 2.");
    s.value("2");


    //step
    av.step();

    kmp_pseudo.setCurrentLine(4);
    align.unhighlight(6);
    master.unhighlight([2,3,4,5]);
    sub.unhighlight([2,3,4,5]);


    for(i=sub.size()-1;i>1;i--){
      sub.value(i, sub.value(i-2));
    }


    for(x = align.size()-1; x > 1; x--){
      align.value(x, align.value(x-2));
    }

    av.umsg("Note now that we still don't have a match at master[m] and sub[s] (master[6] != sub[2]).");


    //step
    av.step();
    align.highlight(6);
    kmp_pseudo.setCurrentLine(10);
    av.umsg("s is still > 0 so we head down to our else statement and reassign s to align[s] (align[2]) which is just 0.");
    s.value("0");

    //step
    av.step();
    kmp_pseudo.setCurrentLine(4);    
    align.unhighlight(6);
    master.unhighlight([4,5]);
    sub.unhighlight([4,5]);
    for(i=sub.size()-1;i>1;i--){
      sub.value(i, sub.value(i-2));
    }

    for(x = align.size()-1; x > 1; x--){
      align.value(x, align.value(x-2));
    }
    av.umsg("Now we end up back in the same situation after the jump, the mistmatch occurs at master[6] and sub[0] now.");

    av.step();
    av.umsg("We enter the second if statement this time because s == 0, so we just increment m by 1...");
    m.value("7");
    kmp_pseudo.setCurrentLine(8);

    av.step();
    sub.css(6, {"background-color": "white"});
    master.css(6, {"background-color": "white"});    
    for(i=sub.size()-1;i>0;i--){
      sub.value(i, sub.value(i-1));
    }
    for(x = align.size()-1; x > 0; x--){
      align.value(x, align.value(x-1));
    }   
    av.umsg("We are now comparing master[7] to sub[0].");
    kmp_pseudo.setCurrentLine(4);



    //step
    av.step();
    master.highlight([7,8,9,10,11,12,13,14]);
    sub.highlight([7,8,9,10,11,12,13,14]);
    sub.css(15, {"background-color": "red"});
    master.css(15, {"background-color": "red"});      

    av.umsg("We get to travel through our loop successfully incrementing m and s 8 times now because all of the characters in master[7-14] and sub[0-7] matched one another, but we will notice a mismatch at master[15] and sub[8]...");
    m.value("15");
    s.value("8");



    av.step();
    av.umsg("We enter our else statement this time because we know s != 0 and the current characters don't match.");
    kmp_pseudo.setCurrentLine(9);

    //step
    av.step();

    align.highlight(15);
    av.umsg("We now get to see why KMP is such a cool algorithm. We look back at our alignment array and see that at align[s] (align[8]) we get to reassign s to 1!");
    s.value("1");
    kmp_pseudo.setCurrentLine(10);

    //step
    av.step();
    master.unhighlight();
    sub.unhighlight();
    align.unhighlight();
    sub.css(15, {"background-color": "white"});
    master.css(15, {"background-color": "white"});    
    for(i=sub.size()-1;i>6;i--){
      sub.value(i, sub.value(i-7));
    }

    for(x = align.size()-1; x > 6; x--){
      align.value(x, align.value(x-7));
    }
    av.umsg("Wow! How Exciting! We just skipped over 6 comparisons that the naive method would have had to make!");

    //step
    av.step();

    sub.css(15, {"background-color": "red"});
    master.css(15, {"background-color": "red"});  
    align.highlight(15);
    av.umsg("We know take a look at master[15] and sub[1] which don't match.");
    kmp_pseudo.setCurrentLine(4);

    av.step();
    av.umsg("We go back into our else statement because s != 0 and we reset s to align[s] (align[1]) which is 0.");
    kmp_pseudo.setCurrentLine(10);
    s.value("0");


    //step
    av.step();
    for(i=sub.size()-1;i>0;i--){
      sub.value(i, sub.value(i-1));
    }
    for(x = align.size()-1; x > 0; x--){
      align.value(x, align.value(x-1));
    }
    av.umsg("Right away our new alignment doesn't match and s == 0 so we increment m by 1 to compare the next spot in the master string.");
    m.value("16");
    align.unhighlight(15);
    kmp_pseudo.setCurrentLine(8);


    av.step();
    for(i=sub.size()-1;i>0;i--){
      sub.value(i, sub.value(i-1));
      align.value(i, align.value(i-1));
    }
    for(var j = 16; j < master.size(); j++) {
      sub.highlight(j);
      master.highlight(j);      
    }
    av.umsg("We move through the next 9 characters easily, entering our first if statement every time and increasing m and s by a total of 8 after 8 iterations");
    s.value("8");
    m.value("24");
    kmp_pseudo.setCurrentLine(4);
    sub.css(15, {"background-color": "white"});
    master.css(15, {"background-color": "white"});  


    av.step();
    av.umsg("It is at this point that we notice that s is no longer < sub.length and we break out of our loop...");
    kmp_pseudo.setCurrentLine(3);


    av.step();
    av.umsg("we also not that s == sub.length so we enter our if statement on line 12.");
    kmp_pseudo.setCurrentLine(11);

    av.step();
    av.umsg("We return the value m (24) - sub.length (9), so we know that our match occurs at index 16 of the master")
    kmp_pseudo.setCurrentLine(12);

    //step
    av.step();
    sub.css(15, {"background-color": "white"});
    master.css(15, {"background-color": "white"});  
    align.unhighlight(15);
    for(i=sub.size()-1;i>0;i--){
      sub.value(i, sub.value(i-1));
    }
    for(x = align.size()-1; x > 0; x--){
      align.value(x, align.value(x-1));
    }
    for(var j = 16; j < master.size(); j++) {
      sub.css(j, {"background-color": "green"});
      master.css(j, {"background-color": "green"});      
    }
    av.umsg("We found our match at master[16]!");
    av.recorded();

    </script>
  </body>
</html>