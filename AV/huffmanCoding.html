<!DOCTYPE html>
<html>
<head>
	<title>OpenDSA Textbook: Huffman Coding Tree</title>
	<meta charset="utf-8" />
	<link href="../JSAV/css/JSAV.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript"
		src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>
	<script  src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js">
	</script>
	<script  src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js">
	</script>
	<script src="../JSAV/lib/jquery.transform.light.js"></script>
	<script src="../JSAV/lib/raphael.js"></script>
	<script src="../JSAV/build/JSAV-min.js"></script>
	<script src="../JSAV/build/JSAV.js"></script>
</head>
	
<body>
	<div id="av">
		<div class="jsavcontrols"></div>
		<p class="jsavoutput jsavline"></p>
	</div>
	<script>
	// sorting the elements of an array with Insertation Sort
	var sortArray = function (anArray, tArray) {
		for (var i = 1; i < anArray.length; i++) {
			var key = anArray[i];
			var tmp = tArray[i];
			var j = i - 1;
			while(j >= 0 && key < anArray[j]) {
				anArray[j + 1] = anArray[j];
				tArray[j + 1] = tArray[j];
				j--;
			}
			anArray[j + 1] = key;
			tArray[j + 1] = tmp
		}	
	}

	// shuffle the array by moving left
	var shuffle = function (anArray, tArray, key, node) {
		anArray[1] = key;
		tArray[1] = node;
		for (var i = 0; i < anArray.length - 1; i++) {
			anArray[i] = anArray[i + 1];
			tArray[i] = tArray[i + 1];
		}
		anArray.length -= 1;
		tArray.length -= 1;
	}

	// Constructing the huffmanCodingTree
	var huffTree = function (nArray, tArray) {
		while (nArray.length > 1) {
			sortArray(nArray, tArray);

			var key = nArray[0] + nArray[1];
			if (nArray.length == 2) {
				var node = bt.root(key);
			}
			else {
				var node = bt.newNode(key);
			}
			node.left(tArray[0]);
			node.right(tArray[1]);

			shuffle(nArray, tArray, key, node);
		}	
	}

    // traverse to re-set background color of the entire tree
    var traverse_color = function(node, col) {
		var val = node.value();

		// the node is an empty node	
		if (!val || val === "jsavnull") {	
			return;
		} 
		else {
			// if the node is an internal node, then display an circle
			if (node.left()) {
				node.css("background-color", col);
				// var pos = node.edgeToParent().position();
				traverse_color(node.left(),col);
			}
			if (node.right()) {
				node.css("background-color", col);
				traverse_color(node.right(),col);
			}
			// if the node is a leaf node, then display an rectangle
			else
			node.css({"height": "90px", "width": "45px", "border-radius":1});
		}
    }
    
	var jsav = new JSAV("av");
	var bt = jsav.ds.bintree();
	var caption_label = jsav.label("Huffman Coding Tree Construction", {before: bt});
	var caption_text = "";
	jsav.step();	

	// userArry: an array to store the number and character
	var userArray = new Array();
	userArray[0] = 32;
	userArray[1] = "C";
	userArray[2] = 42;
	userArray[3] = "D";
	userArray[4] = 120;
	userArray[5] = "E";
	userArray[6] = 7;
	userArray[7] = "K"
	userArray[8] = 42;
	userArray[9] = "L"
	userArray[10] = 24;
	userArray[11] = "M";
	userArray[12] = 37;
	userArray[13] = "U";
	userArray[14] = 2;
	userArray[15] = "Z";

	// treeArray: an array to store the information of HuffmanCodingTree
	var treeArray = new Array();
	var numArray = new Array();
	for (var i = 0, j = 0; i < userArray.length - 1; i += 2, j++) {
		value = userArray[i] + "<br />" + userArray[i + 1];
		treeArray[j] = bt.newNode(value);
		numArray[j] = userArray[i];
	//	document.write(treeArray[j].value() + "<br />");
	}

	huffTree(numArray, treeArray);

//		var index = treeArray[i].value().indexOf("<br />");
//		testArray[i] = treeArray[i].value().substring(0, index);

	traverse_color(bt.root(), "white");
	bt.layout();
	
    jsav.recorded(); // done recording changes, will rewind
    
    $(".jsavtreenode").live("hover", function() {
	//console.log($(this).text(), $(this).offset().left, $(this).offset().top);
    });
    $("path").live("hover", function() {
	//console.log($(this).attr("d"));
    });
// end hiding contents from old browsers  -->
    </script>
</body>
