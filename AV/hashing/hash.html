<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Simple Hash</title>
  <link href="../opendsaAV.css" title="CSS" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="../../JSAV/css/JSAV.css" type="text/css" />
<style>

#container {
  width: 790px;
  height: 465px;
  border: 1px solid black;
  background-color: #efe;
  padding: 10px;
  overflow: hidden;
}

#bottom {
  width: 790px;
  height: 48px;
  border: 1px solid black;
  background-color: #ddd;
  padding: 10px;
  overflow: hidden;
}

title {
	text-align: center;
}

div h1 {
  background-color: #efe;
  margin: 5px;
}

.jsavcontainer {
  background-color: #efe;
  border: none;
}

.jsavarray {
   padding-left:0;
   text-align: center;
   position: absolute;
   left: 350px;
}

p.jsavoutput.jsavline {
  height: 30px;
  margin: 0;
}

#about {
  float: right;
}

a.jsavsettings {
  display: block;
  margin-top: 10px;
  margin-left: 10px;
}

form {
  clear: both;
}
</style>
</head>

<body>

	<!-- Main Container -->
	<div id="container">
		<p class="jsavoutput jsavscroll" readonly="readonly" style="width:225px; height:400px;  float:left"> </p>
	</div>

	<!-- Bottom Container -->
	<div id="bottom">
	
		<form id="ssperform">
			<p align="center">
			
				<!-- Function Dropdown -->
				<select id="function">
					<option selected value = 0> Choose Hashing Function </option>
					<option value = 1> Simple Mod Hash </option>
				</select>
			
				<!-- Array Size Dropdown -->
				<select id="arraysize">
					<option selected value = 0> Table Size </option>
					<option value = 1> 1 </option>
					<option value = 2> 2 </option>
					<option value = 3> 3 </option>
					<option value = 4> 4 </option>
					<option value = 5> 5 </option>
					<option value = 6> 6 </option>
					<option value = 7> 7 </option>
					<option value = 8> 8 </option>
					<option value = 9> 9 </option>
					<option value = 10> 10 </option>
					<option value = 11> 11 </option>
					<option value = 12> 12 </option>
					<option value = 13> 13 </option>
					<option value = 14> 14 </option>
					<option value = 15> 15 </option>
					<option value = 16> 16 </option>
				</select>
				
				<!-- Collision Resolution Dropdown -->
				<select id="collision">
					<option selected value = 0> Collision Resolution Policy </option>
					<option value = 1> Linear Probing </option>
				</select>
				
				<label for="input">&nbsp;Input:</label>
				<input size="10" name="input" id="input" type="text" />
				&nbsp;
				<!-- Buttons --> 				
				<input type="button" name="next" value="Next" />
				<input type="button" name="reset" value="Restart" />
				<input type="button" name="help" value="Help" />
			</p>
		</form>
		
	</div>


<script
   src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js">
</script>
<script
  src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js">
</script>
<script src="../../JSAV/lib/jquery.transform.light.js"></script>
<script src="../../JSAV/build/JSAV-min.js"></script>
<script type="text/javascript" src="Queue.js"></script>

<script>
 
/* The fun starts here  */
(function($) {

  /* Variables */
  var arraySize;					// Table size
  var theArray = [];				// Actual array
  var av;							// JSAV
  var arr;						// JSAV Array
  var fullArray= false;           // Flag that determines whether array is full or not
  var nextStep = new Queue();		/* A queue that will contain the "next step". Stores 
																	position and value of next step as an object */
  // Initialize JSAV object
  av = new JSAV("container");
  av.umsg("Please select a hashing function");
		
  // Connect action callbacks to the HTML entities
  $('input[name="about"]').click(about);
  $('input[name="next"]').click(next);
  $('input[name="reset"]').click(reset);
  		
  // Call reset - the initial state of the vizualization
  reset();
  		
  /* Settings Function */
  // create a new settings panel and specify the link to show it
  var settings = new JSAV.utils.Settings($(".jsavsettings"));
  // add the layout setting preference
  var arrayLayout = settings.add("layout", {"type": "select", "options": {"bar": "Bar", "array": "Array"}, "label":"Array layout: ", "value": "bar"});

  // Process About button: Pop up a message with an Alert
  function about() {
	var mystring = "Hashing  Visualization\nWritten by ...\nCreated as part of the OpenDSA hypertextbook project.\nFor more information, see http://algoviz.org/OpenDSA\nWritten during Spring, 2012\nLast update: January, 2012\nJSAV library version " + JSAV.version();
    alert(mystring);
  }
  
  
  /* Reset Function */
  function reset() {
	  
  	// Clear messages
    if (av) {
      av.clearumsg();
      av.umsg("Please select a hashing function");
    }
      		
    // Hide array if one exists
    if (arr) {
      arr.hide();
    }
      			
   	// Reset & disable dropdowns
    $("#function").val(0);
    $("#arraysize").val(0);
    $("#collision").val(0);
    $('#arraysize').attr("disabled", "disabled");
    $('#input').attr("disabled", "disabled");
    $('#collision').attr("disabled", "disabled");
    		
    // Disable buttons
    $('input[name="next"]').attr("disabled", "disabled");
    		
    // Enable function change dropdown
    $("#function").removeAttr("disabled");
	}
	
	/* 
   * Creates a handler that will wait until the event hasn't fired for a period
   * before it fires the actual event handler
   */
	function createBuffered(fun, delay) {
  	  var timer;
      return function() {
        clearTimeout(timer);
        var args = arguments;
        var me = this;
        timer = setTimeout(function() {
      	  fun.apply(me, args);
        }, delay);
      }
    }

  // key that will run 300 ms after the user stops typing in input
  $('#input').keypress( createBuffered(function() {
  
  	// Input field value
  	var inputVal = $(this).val();
    		
  	// Check if input is a valid number
  	if (isNaN(inputVal)) {
  	  av.umsg("Please enter a valid number");
	  }
    		
	  else {
    		
  	  // Disable input field to process it safely
      $("#input").attr("disabled", "disabled");
    			
      // Disable array size drop down to avoid havoc
      $("#arraysize").attr("disabled", "disabled");    			
    		
      // Process input with selected function
      var hashFunction = $("#function").val();        	
      switch(hashFunction) {
      	// No function chosen
      	case '0':
          reset();
          break;
		  case '1':
      	  simpleMod(inputVal);
          break;
		  }  		
	  }
		
		// Reactivate Next Button
	  $('input[name="next"]').removeAttr("disabled");
	  
	}, 300));
	
	// Event trigger change if hashing function option is changed
	$("#function").change(function() {
	    
	  if ($(this).val() == 0) {
	    reset();
	  }
	    		
	  else {
	    	
	    // Enable table size
	    $("#arraysize").removeAttr("disabled");
	    		
	    // Disable function change
	    $("#function").attr("disabled", "disabled");
	    		
	    // Choose linear probing resolution policy
	    switch ($(this).val()) {
	      // Linear probing for simple mod
	      case '1':
	    	$("#collision").val(1);
	    	break;
	    }
	  }
	});
	
	// Event trigger change if size of hash changes
	$("#arraysize").change(function() {
	    
		// Hide previous array if it exists
	  if (arr) {
		arr.hide();
	  }
		
	  /*
	   * Handle array size change in middle of hashing
	   */
		
	  // Draw new array
	  var arraySize = $('#arraysize').val();
	  theArray.length = arraySize;
	  // Initialize JSAV
	  arr = av.ds.array(theArray, {indexed: true, layout: "vertical"});
	  
	  // Enable input field
	  $("#input").removeAttr("disabled");
	});
	
	
	/* Next button pushed - load next slides */
	function next() {
	
	  // Insert new empty line
	  av.umsg("\n");
		
	  var next = nextStep.dequeue();
		
	  // If activity is insertion
	  if (next.insert) {
	    av.umsg("Inserting " + next.value + " at position " + next.position + ".");
		arr.unhighlight(next.position);
		arr.value(next.position, next.value);
	  }
		
	  // If activity is only highlighting
	  else {
	    av.umsg("Attempting to insert " + next.value + " at position " + next.position + ".");
		arr.unhighlight(next.position-1);
		arr.highlight(next.position);
	  }
					
	  // Disable Next Button & renable input field if queue is empty
	  if (nextStep.isEmpty()) {
		  
	  // Handle if array is full at the end
      if (fullArray) {
	    av.umsg("Array is full. Insertion failed.");
		// Reset flag
		fullArray = false;
	  }
		
	  $('input[name="next"]').attr("disabled", "disabled");
	  $("#input").removeAttr("disabled");
	  }
	}
	    
	// Simple mod function
	function simpleMod(inputVal) {
	    	
		// Simple Mod Function
	  var pos = inputVal % theArray.length;
	    	
	  // Linear Probing Resolution
	  linearProbing(inputVal, pos);
	}
	
	
	/* Collision Resolutions */
		
	// Linear Probing
	function linearProbing(inputVal, pos) {
		
	  // If pos is full, start resolution.
	  // Cast into a number, otherwise '0' will be considered false.
	  if ((Number(arr.value(pos))) !== false) {
						
		// Temp pointer that will point to the correct position at the end of the loop
		var i = pos;
		// Counter that counts how many times the array ran
		var count = 0;
				
		// Loop across the array. "infinite" loop. Breaks if array is full.
		for (;;) {
					
		  // If array is full, break out
		  if (count == arr.size()) {
			fullArray = true;
			break;
		  }
					
		  // If space is available, break
		  if (String(arr.value(i)) == "") {
			break;
		  }
					
		  // Insert attempt as highlighting activity
		  insertActivity(i, inputVal, false);
				
		  // If i is last element of arr, restart to position 0 of the array
		  if (i == arr.size() - 1) {
			i = 0;
		  }
						
		  // Otherwise just increment i by 1 (to check for next pos of array next iteration)
		  else {
			i++;
	      }
					
		  // Increment count 
		  count++;
		}
		
		// Empty spot found. Insert element inputVal at i
		if (!fullArray) {
		  insertActivity(i, inputVal, true);
		  }
		}
			
		// Otherwise, enqueue insertion activity
		else {
		  // Hashing position found. Insert activity.
		  insertActivity(pos, inputVal, true);
		}
	}
		
	/* 
	 * Inserts activity at position pos, with value val and whether it is insertion or highlight
	 * into nextStep queue
	*/
	function insertActivity(pos, val, insert) {
		
		// If activity is insertion
	  if (insert) {
			
	    // Preceed insertion with highlight
	    var posValueHighlight = {
		  position: pos,
		  value: val,
		  insert: false
	    };
	    nextStep.enqueue(posValueHighlight);
			
	    var posValue = {
		  position: pos,
		  value: val,
		  insert: true
	    };
	    nextStep.enqueue(posValue);
	  }
		
	  // Activity is highlight only
	  else {
			
	    var posValue = {
		  position: pos,
		  value: val,
		  insert: false
      };
	  nextStep.enqueue(posValue);
	  }
	}
})(jQuery);
    
</script>

</body>
</html>
