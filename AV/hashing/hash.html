<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Simple Hash</title>
  <link href="../opendsaAV.css" title="CSS" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="../../JSAV/css/JSAV.css" type="text/css" />
<style>

#container {
  width: 790px;
  height: 465px;
  border: 1px solid black;
  background-color: #efe;
  padding: 10px;
  overflow: hidden;
}

#bottom {
  width: 790px;
  height: 48px;
  border: 1px solid black;
  background-color: #ddd;
  padding: 10px;
  overflow: hidden;
}

title {
	text-align: center;
}

div h1 {
  background-color: #efe;
  margin: 5px;
}

.jsavcontainer {
  background-color: #efe;
  border: none;
}

.jsavcounter {
  float: left;
  width: 100px;
}

.jsavarray {
  padding-left:0;
  text-align: center;
}

.jsavarray {
   padding-left:0;
   text-align: center;
   position: absolute;
   left: 350px;
}


p.jsavoutput.jsavline {
  height: 30px;
  margin: 0;
}
#about {
  float: right;
}
a.jsavsettings {
display: block;
margin-top: 10px;
margin-left: 10px;
}
form {
  clear: both;
}
</style>
</head>

<body>

	<!-- Main Container -->
	<div id="container">
		<p class="jsavoutput jsavscroll" readonly="readonly" style="width:225px; height:400px;  float:left"> </p>
	</div>

	<!-- Bottom Container -->
	<div id="bottom">
	
		<form id="ssperform">
			<p align="center">
			
				<!-- Function Dropdown -->
				<select id="function">
					<option selected value = 0> Choose Hashing Function </option>
					<option value = 1> Simple Mod Hash </option>
				</select>
			
				<!-- Array Size Dropdown -->
				<select id="arraysize">
					<option selected value = 0> Table Size </option>
					<option value = 1> 1 </option>
					<option value = 2> 2 </option>
					<option value = 3> 3 </option>
					<option value = 4> 4 </option>
					<option value = 5> 5 </option>
					<option value = 6> 6 </option>
					<option value = 7> 7 </option>
					<option value = 8> 8 </option>
					<option value = 9> 9 </option>
					<option value = 10> 10 </option>
					<option value = 11> 11 </option>
					<option value = 12> 12 </option>
					<option value = 13> 13 </option>
					<option value = 14> 14 </option>
					<option value = 15> 15 </option>
					<option value = 16> 16 </option>
				</select>
				
				<!-- Collision Resolution Dropdown -->
				<select id="collision">
					<option selected value = 0> Collision Resolution Policy </option>
					<option value = 1> Linear Probing </option>
				</select>
				
				<label for="input">&nbsp;Input:</label>
				<input size="10" name="input" id="input" type="text" />
				&nbsp;
				<!-- Buttons --> 				
				<input type="button" name="hash" value="Next" />
				<input type="button" name="reset" value="Restart" />
				<input type="button" name="help" value="Help" />
			</p>
		</form>
		
	</div>


<script
   src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js">
</script>
<script
  src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js">
</script>
<script src="../../JSAV/lib/jquery.transform.light.js"></script>
<script src="../../JSAV/build/JSAV-min.js"></script>
<script type="text/javascript" src="Queue.js"></script>

<script>
 
	/* The fun starts here  */
	(function($) {
	
		/* Variables */
		var arraySize;					// Table size
		var theArray = [];				// Actual array
		var av;							// JSAV
		var arr;						// JSAV Array
		var nextStep = new Queue();		/* A queue that will contain the "next step". Stores 
											position and value of next step as an object */
									
		//var tracker = 0;
		//var nextState = 0;
		//var pos;
		
		// Connect action callbacks to the HTML entities
		$('input[name="about"]').click(about);
  		$('input[name="hash"]').click(hash);
  		$('input[name="reset"]').click(reset);
  		
  		// Call reset - the initial state of the vizualization
  		reset();
  		
		/* Settings Function */
		// create a new settings panel and specify the link to show it
  		var settings = new JSAV.utils.Settings($(".jsavsettings"));
  		// add the layout setting preference
  		var arrayLayout = settings.add("layout", {"type": "select", "options": {"bar": "Bar", "array": "Array"}, "label":"Array layout: ", "value": "bar"});

		// Process About button: Pop up a message with an Alert
  		function about() {
    		var mystring = "Hashing  Visualization\nWritten by ...\nCreated as part of the OpenDSA hypertextbook project.\nFor more information, see http://algoviz.org/OpenDSA\nWritten during Spring, 2012\nLast update: January, 2012\nJSAV library version " + JSAV.version();
    		alert(mystring);
  		}
  		
  		/* Reset Function */
  		function reset() {
    		
    		// Clear messages
    		if (av) {
      			av.clearumsg();
      			av.umsg("Please select a hashing function");
      		}
      		
      		// Hide array if one exists
      		if (arr)
      			arr.hide();
      			
    		// Reset & disable dropdowns
    		$("#function").val(0);
    		$("#arraysize").val(0);
    		$("#collision").val(0);
    		$('#arraysize').attr("disabled", "disabled");
    		$('#input').attr("disabled", "disabled");
    		$('#collision').attr("disabled", "disabled");
    		
    		// Disable buttons
    		$('input[name="hash"]').attr("disabled", "disabled");
    	}
    	
    	/* Keep checking input textbox value to calculate the next step in a slideshow manner */
  		var inputVal = "";
    	setInterval(checkInputChanged, 1500);

    	function checkInputChanged() {
        	var currentValue = $('#input').val();
        	if (currentValue != inputVal) {
            	inputVal = currentValue;
            	inputChanged(inputVal);
        	}
    	}

    	function inputChanged(inputVal) {
    	
    		// Disable input to process it safely
        	$("#input").attr("disabled", "disabled");
        	
        	var functionValue = $("#function").val();
        	
        	switch(functionValue) {
        		// No function chosen
        		case '0':
        			reset();
        			break;
        		case '1':
        			simpleMod(inputVal);
        			break;
        	}
    	}
	    
	    // Event trigger change if hashing function option is changed
	    $("#function").change(function() {
	    
	    	if ($(this).val() == 0)
	    		reset();
	    		
	    	else {
	    	
	    		// Enable table size & input
	    		$("#arraysize").removeAttr("disabled");
	    		$("#input").removeAttr("disabled");
	    	
	    		// Initialize JSAV object
	    		av = new JSAV("container");
	    		
	    		// Choose linear probing resolution policy
	    		switch ($(this).val()) {
	    			// Linear probing for simple mod
	    			case '1':
	    				$("#collision").val(1);
	    				break;
	    		}
	    	}
	    	
	    	/*switch ($(this).val()) {
	    	
	    		// No function chosen
        		case '0':
        			$("#title").text("Please choose your hashing function from the dropdown box below.");
            		reset();
            		tracker = 0;
        			break;
        		
        		// Simple Mod
        		case '1':
        			if (av)
            			av.clearumsg();
            		tracker = 1;
            		break;
        		}*/
	    });
	    
	    // Event trigger change if size of hash changes
	    $("#arraysize").change(function() {
	    
	    	// Hide previous array if it exists
	    	if (arr)
	    		arr.hide();
	    	
	    	// Draw new array
	    	var arraySize = $('#arraysize').val();
	    	theArray.length = arraySize;
	    	// Initialize JSAV
	    	arr = av.ds.array(theArray, {indexed: true, layout: "vertical"});
	    });
	    
	    function setBlue(index) {
    		arr.css(index, {"background-color": "#ddf" });
  		};
	    
	    // Event trigger click if hash is pushed
	    // Hash button is pushed
		function hash() {
		
			var arraySize = $('#arraysize').val();
			
			// No hashing function is selected
			if (tracker == 0) {
				av.umsg("Please select a hashing function before trying to hash");
			}
		
			else {
			
				// Grab is the user's input
				var inputVal = document.getElementById("input").value;
					
				/* Next button will calculate mod and highlight cell */
				if (nextState == 0) {
				
					// Check for input errors
					if (inputVal.length == 0) {
						av.umsg("Please enter a hashing value");
					}
			
					else if (isNaN(inputVal)) {
						av.umsg("Please enter a valid numeric value to hash");
					}
				
					else {
					
						// Simple Mod Function
						if (tracker == 1)
							simpleMod(inputVal, arraySize);
					
					}
					
					// Changes behaviour of next button click
					nextState = 1;
				}
				
				/* Next button will show the value inserted in the cell */
				else if (nextState == 1) {
				
					// Simple mod next step
					if (tracker == 1) {
						simpleModStep(inputVal, pos);
						nextState = 0;
					}
				}
			}
		}
	    
	    // Simple mod function
	    function simpleMod(inputVal) {
	    		    	
	    	var posValue = linearProbing(inputVal);
	    	nextStep.enqueue(posValue);
	    	
	    	var pos = inputVal % theArray.length;
	    	
	    	var posValue = {
	    		position: pos,
	    		value: inputVal
	    	};
	    	
	    	//nextStep.push(posValue);	    	
	    
			//av.umsg("The value entered is " + inputVal);
			//pos = inputVal % theArray.length;
			//arr.highlight(pos);
	    }
	    
	    // Simple mod function - state 1: insert value
	    //function simpleModStep(inputVal, pos) {
	    //	arr.unhighlight(pos);
		//	setBlue(pos);
		//	arr.value(pos, inputVal);
		//}
		
		/* Collision Resolutions */
		
		// Linear Probing
		function linearProbing(inputVal) {
		
			var pos = inputVal % theArray.length;
			
			// If pos is full, start resolution
			if (arr.value(pos)) {
				
				// Temp pointer that will point to the correct position at the end of the loop
				var i = pos;
				// Counter that counts how many times the array ran
				var count = 0;
				
				// Start at pos, until that pos is occupied
				for (i = pos; arr.value(pos); i++) {
				
					if (count == arr.size)
						av.umsg("Array is full");
				
					// If i is last element of arr, restart to position 0 of the array
					if (i == arr.size()-1) {
						i = 0;
					}
					
					count++;
				}
				
				var posValue = {
					position: i,
					value: inputVal
				};
				
				return posValue;
			}
			
			// Otherwise, just return next step in posValue object
			else {
				var posValue = {
					position: pos,
					value: inputVal
				};
				
				return posValue;
			}
		
		}
	    
    })(jQuery);
    
</script>


</body>
</html>
