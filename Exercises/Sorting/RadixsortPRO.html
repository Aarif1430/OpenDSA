<!--
Radix Sort mini-proficiency exercise.
Written by Gayathri Subramanian and Cliff Shaffer
-->

<!DOCTYPE html>
<html data-require="math">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Radix Sort Exercise</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
  <script src="../../JSAV/lib/jquery.transform.light.js"></script>
  <script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/1.1-latest/MathJax.js?config=http://algoviz.org/OpenDSA/dev/OpenDSA/ODSAkhan-exercises/KAthJax-77111459c7d82564a705f9c5480e2c88.js">
  </script>
  <script type="text/javascript" src="/MathJax/MathJax.js?config=default"></script>
  <script>urlBaseOverride = "../../ODSAkhan-exercises/";</script>
  <script src="../../ODSAkhan-exercises/khan-exercise.js"></script>
  <script src="../../JSAV/build/JSAV-min.js"></script>
  <link rel="stylesheet" href="../../JSAV/css/JSAV.css" type="text/css" />
  <style>
    #container {
      border: 0;
      width: 780px;
      height: 740px;
      padding: 10px;
      overflow: hidden;
    }

    .jsavarray { position: absolute; }

    #container .jsavarray {
      left: -10px;
      height: 80px;
    }

    #reset { margin-right: 20px;}

    .jsavindex .jsavvalue {
      height: 100%;
      width: 100%;
    }
  </style>
</head>

<body>
<script>
var
  jsav,           // The JSAV object
  arr_size,       // Full array size
  userInput,      // Boolean: Tells us if user ever did anything
  arrdata = [],       // The array to be sorted; keep for reset
  jsavInput,
  jsavBins,
  jsavLists = [],
  empty = [],         // Dummy for empty data to reset bin array
  isSelected;     // Boolean: True iff user has already clicked an array element

var blockHeight = 47;  // Width of an array element

// Variables used to keep track of the index and array of the
// currently selected element within click handler
var ValueIndex = -1;

// Handle a click event on an array
// On click of bottom array element, highlight.
// On click of (free) position in top array, move highlighted element there.
var clickHandler = function (arr, index) {
  if (ValueIndex === -1) {
    // Nothing is selected. We must be in the input array
    if (arr !== jsavInput) { return; } // Wasn't in input array
    // Don't let the user select an empty element,
    if (arr.value(index) === "") { return; }
    arr.highlight(index);
    ValueIndex = index;
  } else {
    // We should be setting the value into a bin
    if (arr !== jsavBins) { return; } // Wasn't in bin array
    // Deselect the currently selected element
console.log("List " + index + " has size " + jsavLists[index].size());
    if (jsavLists[index].size() === 0) {
console.log("Add first");
      jsavLists[index].addFirst(jsavInput.value(ValueIndex));
    } else {
console.log("Add last");
      jsavLists[index].addLast(jsavInput.value(ValueIndex));
    }
    jsavLists[index].layout({center: false});
    jsavInput.unhighlight(ValueIndex);
    arr.value(index, jsavInput.value(ValueIndex));
    jsavInput.value(ValueIndex, "");
    ValueIndex = -1;
console.log("Got here");
  }
  userInput = true;
};

// function that creates and initialises the arrays
function resetInit() {
  // Do initializations, both for initial use and reset
  userInput = false;
  ValueIndex = -1;
  jsavInput = jsav.ds.array(arrdata, {indexed: true, center: false,
                            layout: "vertical", top: 10});
  jsavInput.click(function (index) { clickHandler(this, index); });
  jsavBins = jsav.ds.array(empty, {indexed: true, center: false,
                           layout: "vertical", top: 10, left: 200});
  jsavBins.click(function (index) { clickHandler(this, index); });
}

// reset function definition
var f_reset = function () {
  jsavInput.clear();
//  DELETE ALL OF THE LISTS
  resetInit();
};

// function that initialise JSAV library
var initJSAV = function (asize, qchoice) {
  // Do all of the one-time initializations
  arr_size = asize;
  jsav = new JSAV($("#container"));
  arrdata = JSAV.utils.rand.numKeys(0, 999, arr_size);
  for (i = 0; i < 10; i++) {
    empty[i] = "";
    jsavLists[i] = jsav.ds.list({top: (11 + i * 47), left: 260, nodegap: 30});
  }
  resetInit();
  // Set up handler for reset button
  $("#reset").click(function () { f_reset(); });
};
	
// Check user's answer for correctness: User's array must match answer
function checkAnswer(arr_size) {
  var i;
//  WRITE THE TEST TO CHECK ANSWER
  return true;
}
</script>
<div class="exercise">
  <div class="vars">
    <var id="arr_size">randRange(6, 10)</var>
    <var id="qchoice">randRange(0, 2)</var>
    <var id="msgArray">[ "right-most", "middle", "left-most"]</var>
    <var id="JSAV">initJSAV(arr_size, qchoice)</var>
  </div>

  <div class="problems">
    <div> <!-- Supresses answer box -->
      <div class="question">
	<p>Move each record on the left to the appropriate bin on the
          right based on the <b><var>msgArray[qchoice]</var></b> digit.</p>
        <input id="reset" type="button" value="Reset" />
	<div id="jsav" class="jsavcanvas"></div>
      </div>
      <div class="solution" data-type="custom">
	<div class="guess">
          [userInput]
        </div>
	<div class="validator-function">
          if (!checkAnswer(arr_size) && !guess[0])
          return ""; // User did not click, and correct answer is not
	             // initial array state
          else return checkAnswer(arr_size);
	</div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
