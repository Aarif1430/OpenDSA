<!-- TODO:
* Try to get rid of so many global variables
* Don't use JSAV array to compute the answer, since this blinks the
     display.
* Split out JS code to a separate file, and validate it.
-->

<!--
####################################### Insertion Insert_Element ##################################################
#  Question     : Given a random array of size arr_size , and some element X highlighted
#                 Everthing to the left of X is sorted, and everything to the right is random.
#		  Highlighted element needs to be placed in right place by Insertion Sort
#  Variables    : arr_size 6 - 10
#  Chapter      : InsetionSort
#  Author       : Gayathri
#  Date         : July 20, 2012
#######################################################################################################
-->

<!DOCTYPE html>
<html data-require="math">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Insertion Sort Proficiency Exercise</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
  <script src="../../JSAV/lib/jquery.transform.light.js"></script>
  <script src="../../JSAV/lib/raphael.js"></script>
  <script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/1.1-latest/MathJax.js?config=http://algoviz.org/OpenDSA/dev/OpenDSA/ODSAkhan-exercises/KAthJax-77111459c7d82564a705f9c5480e2c88.js">
  </script>
  <script>urlBaseOverride = "../../ODSAkhan-exercises/";</script>
  <script src="../../ODSAkhan-exercises/khan-exercise.js"></script>
  <script src="../../JSAV/build/JSAV-min.js"></script>
  <link rel="stylesheet" href="../../JSAV/css/JSAV.css" type="text/css" />

  <style>
    .jsavcontainer {
      border: 0px;
    }
  </style>
</head>
<body>
<script>
  var jsav, arr , arr_clone, myGuess, spos, nsel, sel1 ;
  	
  // function to handle a click event on an array
  var clickHandler = function(index, e) {
    var sublist;
    sublist = 0;
    if (index <= spos)
      sublist = 1;
    if ( sublist == 1 )	{
      if (nsel === 0) { // if first click
        arr.css(index, {"font-size": "130%"});
	nsel = nsel + 1;
	sel1 = index;
      }
      else {
        arr.swap(sel1,index);
	arr.css(index, {"font-size": "100%"});
	arr.css(sel1, {"font-size": "100%"});
	nsel = 0;
      }
    }
    myGuess = 1;
  }

  // Initialise JSAV library 
  initJSAV = function(a, sort_pos) {
    var i, j;
    myGuess = -1;
    spos = sort_pos;
    nsel = 0;
    jsav = new JSAV("jsav");
    jsav.recorded();
    arr = jsav.ds.array(JSAV.utils.rand.numKeys(0, 999, a),{indexed: true, center: false});
    arr_clone = jsav.ds.array(JSAV.utils.rand.numKeys(0, 999, a));
    arr_clone.hide();
    for (i=0; i<a; i++) {
      arr_clone.value(i,arr.value(i));
    }
    for (i=0; i<sort_pos; i++) {
      for (j=i+1; j<sort_pos;j++) {
	if (arr_clone.value(i) > arr_clone.value(j))
          arr_clone.swap(i,j);
      }
    }
    for (i=0; i<a; i++) {
      arr.value(i,arr_clone.value(i));
    }
    arr.highlight(sort_pos);
    // Compute the correct Answer
    for (i=0; i<= sort_pos; i++) {
      for (j=i+1; j<=sort_pos;j++) {
        if (arr_clone.value(i) > arr_clone.value(j))
          arr_clone.swap(i,j);
      }
    }
    // bind the clickHandler to handle click events on the array
    arr.click(clickHandler);
  }
	
  // Check student's answer for correctness
  function checkAnswer (a, sort_pos) {
    var i;
    // Return false if user has highlighted any position before start_pos
    for (i=0; i < a; i++) {
      if ( arr.value(i) != arr_clone.value(i)) return (2 === 1);
    }
    // All conditions passed, return true
    return ( 1 === 1);
  } 
</script>

<div class="exercise">
  <div class="vars">
    <var id="arr_size">randRange( 6, 10 )</var>
    <var id="sort_pos">randRange(1,arr_size-1)</var>
    <var id="JSAV">initJSAV(arr_size,sort_pos)</var>
  </div>

  <div class="problems">
    <div> <!-- Supresses answer box -->
      <p class="problem">Your task in this exercise is to show the
	behavior for one iteration of the outter for loop of Insertion Sort.
        In the array displayed below, the record at
        position <var>sort_pos</var> is highlighted. Insertion Sort has
        already processed the values to the left of
        position <var>sort_pos</var>, so those elements are sorted.</p>
      <div class="question">
        <p> Perform the next part of Insertion Sort to move the
            highlighted record to its proper place in the array.</p>
        <div id="jsav"></div>
      </div>
      <div class="solution" data-type="custom">
        <div class="guess">
          [myGuess]
        </div>
        <div class="validator-function">
          return checkAnswer (arr_size,sort_pos);
        </div>
      </div>
      <div class="hints">
        <p> Insert the highlighted element in its proper position in the array using Insertion Sort </p> 
        <p> All elements from index 0 to index <var>sort_pos</var> should be in ascending order </p>
      </div>
    </div>
  </div>
</div>
</body>
</html>
