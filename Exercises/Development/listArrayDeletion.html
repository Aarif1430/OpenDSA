<!--
Array-Based List Deletion mini-proficiency exercise.
Written by Junyang Chen and Cliff Shaffer
-->

<!DOCTYPE html>
<html data-require="math">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Array-Based List Deletion Proficiency Exercise</title>
  <script src="../../lib/jquery.min.js"></script>
  <script src="../../lib/jquery-ui.min.js"></script>
  <script src="../../JSAV/lib/jquery.transform.light.js"></script>
  <script src="../../JSAV/lib/raphael.js"></script>
  <script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/1.1-latest/MathJax.js?config=http://algoviz.org/OpenDSA/dev/OpenDSA/ODSAkhan-exercises/KAthJax-77111459c7d82564a705f9c5480e2c88.js">
  </script>
  <script>urlBaseOverride = "../../ODSAkhan-exercises/";</script>
  <script src="../../lib/khan-exercise-min.js"></script>
  <script src="../../JSAV/build/JSAV-min.js"></script>
  <link rel="stylesheet" href="../../JSAV/css/JSAV.css" type="text/css" />

  <style>
    .jsavcontainer {
      border: 120px;
    }
	.jsavcanvas{
		height: 125px;
	}
    #reset { margin-right: 20px;}
  </style>
</head>
<body>

<script>
var	jsav,           // The JSAV object
  answerArr = [], // The (internal) array that stores the correct answer
  cloneArr = [],  // A copy of the (internal) array at the start of the exercise for reset
  jsavArr,        // The array that the user manipulates (JSAV object)
  delPosision,    // deletion location
  delValue,       // deletion value
  userInput,      // Boolean: Tells us if user ever did anything
  selected_index; // Position that has been selected by user for swap

// Click event handler on the array
var clickHandler = function (index, e) {
  if (selected_index === -1) { // if nothing currently selected
	jsavArr.css(index, {"font-size": "130%"});
	selected_index = index;
	jsavArr.highlight(index);
  } else {
 	jsavArr.swap(selected_index, index);
	jsavArr.css(index, {"font-size": "100%"});
	jsavArr.unhighlight(index);
	selected_index = -1;  // Reset to nothing selected
  }
  userInput = true;
};

// reset function definition
var f_reset = function () {
  jsavArr.clear();
  // Re-initialize the displayed array object
  jsavArr = jsav.ds.array(cloneArr, {indexed: true, center: false});
  jsavArr.css({top:50});
  jsavArr.click(clickHandler); // Rebind click handler after reset
  userInput = false;
};

// Initialise the exercise
var initJSAV = function (arr_size, insertPos, insertValue) {
  var i, j;
  var emptyArr = ["","","",""];
  userInput = false;
  selected_index = -1;
  delPosision = insertPos;
  delValue = insertValue;
  
  answerArr.length = 0; // Out with the old
  // Give random numbers in range 0..999
  for (i = 0; i < arr_size; i++) {
    answerArr[i] = Math.floor(Math.random() * 1000);
  }
  	
  // Do a partial insertion sort to set things up
  answerArr.push.apply(answerArr, emptyArr);
  // Now make a copy
  cloneArr = answerArr.slice(0);

  jsav = new JSAV("jsav");
  //jsav.recorded();
  jsavArr = jsav.ds.array(answerArr, {indexed: true, center: false});
  jsavArr.css({top:50});
  var arrowCurr = jsav.g.line(24 + delPosision * 45, 30, 24 + delPosision * 45, 52,{"arrow-end": "classic-wide-long", "opacity": 100,"stroke-width": 2});
	var label = jsav.label("Curr", {before: jsavArr, left: 10 + delPosision * 45, top: 10});	
  answerArr.splice (delPosision, 1);
  answerArr.push("");
 

  // Bind the clickHandler to handle click events on the array
  jsavArr.click(clickHandler);
  // Set up handler for reset button
  $("#delete").click(function (){
	if(selected_index !== -1){
	  jsavArr.unhighlight(selected_index);	
	  jsavArr.css(selected_index, {"font-size": "100%"});
	  if(jsavArr.value(selected_index) != "")
	    jsavArr.css(selected_index, { "background-color": "#ddd" });
	  jsavArr.value(selected_index, "");
	  selected_index = -1;
      userInput = true;
	}
  });

  $("#reset").click(function () { f_reset(); });
};

// Check user's answer for correctness: User's array must match answer
var checkAnswer = function (arr_size) {
	var i;
	for (i = 0; i < arr_size + 4; i++) {
		if (jsavArr.value(i) != answerArr[i]) {
			return false;
		}
	}
	return true;
};
</script>

<div class="exercise">
  <div class="vars">
    <var id="arr_size">randRange(4, 6)</var>
	<var id="insert_value">randRange(0, 999)</var>
	<var id="insert_pos">randRange(0, arr_size-1)</var>
    <var id="JSAV">initJSAV(arr_size, insert_pos,insert_value)</var>
  </div>

  <div class="problems">
    <div> <!-- Supresses answer box -->
      <p class="problem">Your task in this exercise is to show the
        behavior for array-based list deletion.
        In the array displayed below, the "current" position is <b><var>insert_pos</var></b>.</p>
      <div class="question">
        <p>Click on a value to highlight it, then click on the "Delete
           value" button to delete the highlighted element. Move other
           elements in the array as appropriate by first clicking on
           the element that you want to move (to highlight it), then
           clicking on where it goes.</p>
        <input id="reset" type="button" value="Reset" />	
		<input id="delete" type="button" value="Delete value" />
        <div id="jsav"></div>
      </div>
      <div class="solution" data-type="custom">
        <div class="guess">
          [userInput]
        </div>
        <div class="validator-function">
          if (!checkAnswer(arr_size) && !guess[0])
            return ""; // User did not click, and correct answer is not
	               // initial array state
          else return checkAnswer(arr_size);
        </div>
      </div>
      <div class="hints">
        <p>Click the deletion button, then click the "current" element.</p> 
	<p>Shift all elements after "current" one position to the right</p>
        </div>
    </div>
  </div>
</div>
</body>
</html>
